// Betfair account data
var betfair = require("../index.js");
var async = require('async');
var common = require('./common.js');


var root = '../../../'
, env = process.env.NODE_ENV || 'development'
, config = require(root + 'config/config')[env]

// Create session to Betfair
var appKey = process.env['BF_APPLICATION_KEY'] || config.betfair.applicationkey;
var session = common.session = betfair.newSession();
console.log(session);
common.loginName = process.env['BF_LOGIN'] || config.betfair.user;
common.password = process.env['BF_PASSWORD'] || config.betfair.password;

// log all Betfair invocations
session.startInvocationLog({level: 'info', path: 'log_invocations.txt'});

// list countries
function listEvents(data, cb) {
    if (!cb)
        cb = data;

    session.listEvents({}, function (err, res) {
        console.log("listEvents err=%s duration=%s", err, res.duration / 1000);
        console.log("Request:%s\n", JSON.stringify(res.request, null, 2))
        console.log("Response:%s\n", JSON.stringify(res.response, null, 2));
        cb(err, res);
    });
}

async.waterfall([common.login, listEvents, common.logout], function (err, res) {
    console.log("Done, err =", err);
    process.exit(0);
});
